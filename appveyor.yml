version: 0.1.{build}
image: 
  - Visual Studio 2015
  - Visual Studio 2017

platform:
  - x64
configuration:
  - Debug

build_script:
  # hack to stop sea of Xamarin (which isn't being used at all) warnings
  # during cmake configuration
  - del "C:\Program Files (x86)\MSBuild\14.0\Microsoft.Common.targets\ImportAfter\Xamarin.Common.targets"

  - set
  - if %VisualStudioVersion% EQU 14.0 set toolset=Visual Studio 14 2015 Win64
  - if %VisualStudioVersion% EQU 15.0 set toolset=Visual Studio 15 2017 Win64
  - echo %toolset%
  - md build\Win64 
  - cd build\Win64
  - cmake -G "%toolset%" ..\.. 
  - cmake -DCMAKE_BUILD_TYPE=%configuration% -DCMAKE_INSTALL_PREFIX=publish .
  - cmake --build . --target install --config %configuration%
  - cd publish
  - 7z a dimcli-latest.zip include lib
  - cd ..\..\..

artifacts:
  - path: build\Win64\publish\dimcli-latest.zip
    name: dimcli
    type: zip

test_script:
  - build\Win64\bin\cli
